const compressBtn=document.querySelector(".compressBtn");const codeInput=document.querySelector("#codeinput");const codeOutput=document.querySelector("#codeoutput");const copyBtn=document.querySelector(".copyBtn");const clearInputCode=document.querySelector(".clearBtn");const fileInput=document.querySelector("#file-input2");const rigthOptions=document.querySelector(".rigth-options-buttons");const toastContainer=document.querySelector(".toast-container");const stats=document.createElement("div");stats.classList.add("states");rigthOptions.appendChild(stats);rigthOptions.style.display="none";const rgh=document.querySelector(".rgh");let errorTST=false;let modeCompressLanguage="js";const dropBg=document.querySelector(".drop-bg");const dropBgBtn=document.querySelector(".setmenu");const dropBgCloseBtn=document.querySelector(".closeDrop");dropBgBtn.addEventListener("click",()=>{dropBg.classList.toggle("active");});dropBgCloseBtn.addEventListener("click",()=>{dropBg.classList.remove("active");});const btnLanguageModeJs=document.querySelector(".CompressJs");const btnLanguageModeCss=document.querySelector(".CompressCSS");const btnHeaderLanguageModeJs=document.querySelector(".CompressJS");const btnHeaderLanguageModeCss=document.querySelector(".CompressCss");const optionsHeader=document.querySelectorAll(".options");const optionsDrop=document.querySelectorAll(".opt-drop");optionsHeader.forEach((item)=>{item.addEventListener("click",(e)=>{const selectedLanguage=item.classList.contains("CompressJS")?"js":"css";setActiveOption(selectedLanguage);});});optionsDrop.forEach((item)=>{item.addEventListener("click",(e)=>{const selectedLanguage=item.classList.contains("CompressJs")?"js":"css";setActiveOption(selectedLanguage);});});const titlesection=document.querySelector(".sct1");function setActiveOption(language){modeCompressLanguage=language;LanguageModePage(language);updateActiveClasses(language);}function updateActiveClasses(language){optionsHeader.forEach((i)=>{i.classList.toggle("active",(language==="js"&&i.classList.contains("CompressJS"))||(language==="css"&&i.classList.contains("CompressCss")));});optionsDrop.forEach((i)=>{i.classList.toggle("active",(language==="js"&&i.classList.contains("CompressJs"))||(language==="css"&&i.classList.contains("CompressCSS")));});}function LanguageModePage(language){titlesection.textContent=`Faça uma compressão do seu código ${language}`;codeInput.placeholder=`Insira aqui seu codigo ${language}`;}btnLanguageModeCss.addEventListener("click",()=>{modeCompressLanguage="css";LanguageModePage(modeCompressLanguage);dropBg.classList.remove("active");});btnLanguageModeJs.addEventListener("click",()=>{modeCompressLanguage="js";LanguageModePage(modeCompressLanguage);dropBg.classList.remove("active");});btnHeaderLanguageModeCss.addEventListener("click",()=>{modeCompressLanguage="css";LanguageModePage(modeCompressLanguage);});btnHeaderLanguageModeJs.addEventListener("click",()=>{modeCompressLanguage="js";LanguageModePage(modeCompressLanguage);});LanguageModePage(modeCompressLanguage);const fileUpload=document.querySelector(".file-upload");fileUpload.addEventListener("click",()=>fileInput.click());fileInput.addEventListener("change",handleFileUpload);function handleFileUpload(event){const file=event.target.files[0];if(file){const reader=new FileReader();reader.onload=function(e){codeInput.value=e.target.result;toast("Arquivo importado com sucesso!",false);compressBtn.disabled=false;};reader.readAsText(file);}}const importArea=document.querySelector(".drag-files-container");["dragenter","dragover","dragleave","drop"].forEach((eventName)=>{importArea.addEventListener(eventName,preventDefaults,false);});["dragenter","dragover"].forEach((eventName)=>{importArea.addEventListener(eventName,()=>importArea.classList.add("active"));});["dragleave","drop"].forEach((eventName)=>{importArea.addEventListener(eventName,()=>importArea.classList.remove("active"),false);});const fileInput1=document.querySelector("#file-input");importArea.addEventListener("drop",handleDrop,false);importArea.addEventListener("click",()=>fileInput1.click(),false);function preventDefaults(e){e.preventDefault();e.stopPropagation();}document.addEventListener("dragenter",(e)=>{importArea.classList.add("active");});function handleDrop(e){const file=e.dataTransfer.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(e){codeInput.value=e.target.result;toast("Arquivo importado com sucesso!",false);compressBtn.disabled=false;};reader.readAsText(file);}compressBtn.addEventListener("click",function(){const code=codeInput.value;if(!code.trim()){errorTST=true;toast(`Insira um código ${modeCompressLanguage}para comprimir`,errorTST);return;}if(modeCompressLanguage==="js"){try{esprima.parseScript(code);}catch(e){rigthOptions.style.display="flex";errorTST=true;toast("O código JavaScript contém erros de sintaxe.",errorTST);stats.classList.add("error-sintaxe");stats.innerHTML=`${e}:Line:${e.lineNumber},Col:${e.column}`;copyBtn.disabled=true;rgh.style.display="block";clearInputCode.disabled=true;return;}}const config1=document.querySelector("#chk1").checked;const config2=document.querySelector("#chk2").checked;const config3=document.querySelector("#chk3").checked;const compressionLevel=getCompressionLevel({config1,config2,config3});let compressedCode;if(modeCompressLanguage==="js"){compressedCode=compressJavaScript(code,compressionLevel);}else{compressedCode=compressCSS(code,compressionLevel);}copyBtn.disabled=false;clearInputCode.disabled=false;copyBtn.addEventListener("click",()=>{errorTST=false;copyToClipboard(compressedCode);});clearInputCode.addEventListener("click",()=>{codeInput.value="";compressBtn.disabled=true;});codeOutput.textContent=compressedCode;const originalSize=code.length;const compressedSize=compressedCode.length;const reduction=(((originalSize-compressedSize)/originalSize)*100).toFixed(2);stats.classList.remove("error-sintaxe");rigthOptions.style.display="flex";rgh.style.display="block";stats.innerHTML=`Redução de ${reduction}%|Arquivo comprimido:${compressedSize}caracteres|Tamanho Original:${originalSize}caracteres`;});function getCompressionLevel(configs){if(configs.config3){return "heavy";}else if(configs.config2){return "medium";}else if(configs.config1){return "light";}else{return;}}function compressJavaScript(code,level){let compressed=code;if(level==="light"||level==="medium"||level==="heavy"){compressed=compressed.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,"");}if(level==="medium"||level==="heavy"){compressed=compressed.replace(/\s+/g," ").trim();}if(level==="heavy"){compressed=compressed.replace(/\s*([{}=;:,.()<>+\-*/&|!~?^])\s*/g,"$1");compressed=compressed.replace(/;\s*;/g,";");compressed=compressed.replace(/([a-zA-Z_$][a-zA-Z_$0-9]*)\s*=\s*void\s*0/g,"$1=void 0");}return compressed;}function compressCSS(code,level){let compressed=code;if(level==="light"||level==="medium"||level==="heavy"){compressed=compressed.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,"");}if(level==="medium"||level==="heavy"){compressed=compressed.replace(/\s+/g," ").trim();}if(level==="heavy"){compressed=compressed.replace(/\s*([{};:,.()<>+\-*/&|!~?^])\s*/g,"$1");compressed=compressed.replace(/;\s*;/g,";");compressed=compressed.replace(/\s*([{}])\s*/g,"$1");}return compressed;}function toast(textToast,errorToast){const toastBg=document.querySelector(".toast-bg");const toastDimiss=document.querySelector(".dimissToast");const toastText=document.querySelector(".text-toast");toastText.textContent=textToast;toastBg.classList.add("active");console.log(errorToast);toastContainer.classList.add("animate__animated","animate__bounceIn");if(errorToast){toastContainer.classList.add("error");}else{toastContainer.classList.remove("error");}setTimeout(()=>{toastBg.classList.remove("active");toastContainer.classList.remove("animate__animated","animate__bounceIn");},5000);toastDimiss.addEventListener("click",()=>{toastBg.classList.remove("active");toastContainer.classList.remove("animate__animated","animate__bounceIn");});}function copyToClipboard(text){if(navigator.clipboard){navigator.clipboard.writeText(text).then(()=>{toast("Codigo copiado com sucesso!",errorTST);}).catch((err)=>{console.error("Erro ao copiar o codigo:",err);toast("Erro ao copiar o codigo",errorTST);});}}const aboutBtn=document.querySelector(".aboutBtn");aboutBtn.addEventListener("click",()=>{showDialog("Sobre o site","Ir para o projeto no GitHub");});const reportBtn=document.querySelector(".reportBugs");reportBtn.addEventListener("click",()=>{showDialog("Bugs Encontrados | Feedback","Reportar bug | Sugestões");});function showDialog(DialogTitle,ButtonAction){const bgDialog=document.querySelector(".dialog-bg");bgDialog.classList.add("active");const dialogContent=document.createElement("div");dialogContent.classList.add("dialog-content");const hr1=document.createElement("hr");const hr2=document.createElement("hr");const headerDialog=document.createElement("div");headerDialog.classList.add("header-dialog");const leftHeaderDialog=document.createElement("div");leftHeaderDialog.classList.add("left-area-d");const icon1=document.createElement("i");icon1.classList.add("bi","bi-book-fill");const closeDialog=document.createElement("i");closeDialog.classList.add("bi","bi-x","closeDialog");const titleDialog=document.createElement("h1");titleDialog.classList.add("title-dialog");titleDialog.textContent=DialogTitle;const descriptionDialog=document.createElement("h4");descriptionDialog.classList.add("description-text");descriptionDialog.innerHTML=getDescriptionText(DialogTitle);const iconSetBtn=document.createElement("i");iconSetBtn.classList.add("bi","bi-arrow-right-square");const buttonSet=document.createElement("button");buttonSet.classList.add("dbtn-action");buttonSet.textContent=ButtonAction;buttonSet.appendChild(iconSetBtn);buttonSet.addEventListener("click",()=>{handleButtonAction(ButtonAction);});leftHeaderDialog.appendChild(icon1);leftHeaderDialog.appendChild(titleDialog);headerDialog.appendChild(leftHeaderDialog);headerDialog.appendChild(closeDialog);dialogContent.appendChild(headerDialog);dialogContent.appendChild(hr1);dialogContent.appendChild(descriptionDialog);dialogContent.appendChild(hr2);dialogContent.appendChild(buttonSet);bgDialog.appendChild(dialogContent);closeDialog.addEventListener("click",()=>{bgDialog.classList.remove("active");bgDialog.innerHTML="";});}
function getDescriptionText(title) {
  switch (title) {
    case "Sobre o site":
      return `
          <p>O <strong>Mix Compressor</strong> é uma ferramenta poderosa e fácil de usar que ajuda os desenvolvedores a otimizar seus códigos CSS e JavaScript. Isso resulta em um carregamento mais rápido e desempenho mais rápido das páginas web.</p> <hr>
          <ul>
            <li><strong>Compressão de Código CSS e JavaScript:</strong> Vários níveis de compressão disponíveis: <strong>Leve</strong>, <strong>Média</strong> e <strong>Forte</strong>.</li> <hr>
            <li><strong>Interface Intuitiva:</strong> Área de entrada e saída de código, importação de arquivos via drag-and-drop.</li> <hr>
            <li><strong>Modo de Seleção de Linguagem:</strong> Alternância fácil entre compressão de CSS e JavaScript.</li> <hr>
            <li><strong>Estatísticas de Compressão:</strong> Informações detalhadas sobre a redução de tamanho do código.</li> <hr>
            <li><strong>Cópia para Área de Transferência:</strong> Fácil cópia do código comprimido.</li> <hr>
            <li><strong>Link do criador</strong>: <a class="link" href="https://github.com/xtei" target="_blank">Acessar o GitHub</a></li>
          </ul>
        `;
    case "Bugs Encontrados | Feedback":
      return `
          <p>Olá, você pode reportar o bug OU realizando um feedback clicando no botão abaixo, onde será redirecionado ao gmail ou enviando um email para: <hr><strong>mixcompress@gmail.com</strong><hr>antes disso:</p> <hr>
          <ul>
            <li>Certifique-se de que o código não contenha erros antes de comprimir.</li> <hr>
            <li>Verifique o resultado da compressão para garantir que todas as funcionalidades do código original foram preservadas.</li> <hr>
            <li>Utilize as diferentes opções de compressão conforme necessário para otimizar seu código de maneira eficiente.</li> <hr>
            <li><strong>Atenção para o uso de otimização Forte para codigos em CSS:</strong> Pode ocorrer que ao comprimir seu codigo <strong>CSS</strong> no modo <strong>Forte</strong>, junte algumas linhas, assim podendo remover a estilização dos elementos afetados. Você pode prefirir também, utilizar o modo de otimização Media, onde também é uma boa forma de otimizar o codigo.</li>
          </ul>
        `;
    case "Feedback":
      return `
          Seu feedback é importante, assim melhoramos o site e corrigimos bugs, com suas sugestões e reclamações <hr>
        `;
    default:
      return "Descrição padrão para outros diálogos.";
  }
}

function handleButtonAction(action) {
  switch (action) {
    case "Ir para o projeto no GitHub":
      window.location.href = "https://github.com/xtei/MXCompress";
      break;
    case "Reportar bug | Sugestões":
      window.location.href =
        "mailto:mixcompress@gmail.com?subject=Bug%20Report%20|%20SUGESTÃO&body=Descreva%20o%20PROBLEMA%20aqui%20ou%20faça%20uma%20SUGESTÃO";
      break;
    default:
      alert("Ação de botão padrão.");
  }
}
